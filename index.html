<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
  <title>VSCode Mobile</title>

  <!-- Prism CSS for syntax highlighting -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

  <style>
    :root {
      --editor-bg: #1e1e1e;
      --sidebar-bg: #252526;
      --tab-bg: #2d2d30;
      --tab-active-bg: #1e1e1e;
      --status-bar-bg: #007acc;
      --text-color: #d4d4d4;
      --line-number-color: #858585;
      --border-color: #444;
      --accent-color: #007acc;
      --menu-bg: #333;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      background-color: var(--editor-bg);
      color: white;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      overflow: hidden;
      font-size: 14px;
      height: 100vh;
      width: 100vw;
      display: flex;
      flex-direction: column;
    }

    .top-bar {
      background-color: var(--menu-bg);
      height: 40px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      flex-shrink: 0;
      overflow: hidden;
    }

    .menu-bar {
      display: flex;
      align-items: center;
      font-size: 13px;
      padding-left: 5px;
      overflow-x: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .menu-bar::-webkit-scrollbar {
      display: none;
    }

    .menu-item {
      padding: 5px 8px;
      cursor: pointer;
      border-radius: 3px;
      transition: background-color 0.2s;
      white-space: nowrap;
    }

    .menu-item:hover {
      background-color: #37373d;
    }

    .file-tabs-container {
      flex: 1;
      display: flex;
      align-items: center;
      margin-left: 10px;
      overflow-x: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .file-tabs-container::-webkit-scrollbar {
      display: none;
    }

    .file-tabs {
      display: flex;
      align-items: center;
      height: 100%;
    }

    .tab {
      background-color: var(--tab-bg);
      padding: 8px 12px;
      border-radius: 0;
      font-size: 13px;
      cursor: pointer;
      border: 1px solid var(--border-color);
      border-bottom: none;
      display: flex;
      align-items: center;
      gap: 6px;
      min-width: 120px;
      max-width: 200px;
      position: relative;
      height: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tab.active {
      background-color: var(--tab-active-bg);
      border-bottom: 2px solid var(--accent-color);
    }

    .tab .close-btn {
      font-size: 14px;
      padding: 2px;
      border-radius: 2px;
      opacity: 0.7;
      transition: opacity 0.2s, background-color 0.2s;
      flex-shrink: 0;
    }

    .tab .close-btn:hover {
      opacity: 1;
      background-color: #444;
    }

    .tab-name {
      overflow: hidden;
      text-overflow: ellipsis;
      flex-grow: 1;
    }

    .new-tab-btn {
      background: none;
      border: none;
      color: #cccccc;
      font-size: 16px;
      padding: 8px;
      cursor: pointer;
      border-radius: 3px;
      margin-left: 5px;
      flex-shrink: 0;
    }

    .new-tab-btn:hover {
      background-color: #37373d;
    }

    .side-bar {
      width: 35px;
      background-color: var(--sidebar-bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 8px;
      border-right: 1px solid var(--border-color);
      flex-shrink: 0;
    }

    .side-bar .icon {
      font-size: 16px;
      margin: 8px 0;
      cursor: pointer;
      padding: 6px;
      border-radius: 3px;
      transition: background-color 0.2s;
    }

    .side-bar .icon:hover {
      background-color: #37373d;
    }

    .main-container {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    .editor-wrapper {
      flex: 1;
      display: flex;
      background-color: var(--editor-bg);
      overflow: hidden;
    }

    .line-numbers {
      background-color: var(--editor-bg);
      color: var(--line-number-color);
      padding: 10px 8px;
      border-right: 1px solid var(--border-color);
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      line-height: 1.5;
      text-align: right;
      user-select: none;
      min-width: 40px;
      white-space: pre;
      overflow: hidden;
      height: 100%;
    }

    .editor-container {
      flex: 1;
      padding: 10px 15px;
      white-space: pre;
      overflow-y: auto;
      overflow-x: auto;
      font-size: 14px;
      background-color: var(--editor-bg);
      color: var(--text-color);
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      line-height: 1.5;
      tab-size: 2;
    }

    .status-bar {
      height: 22px;
      background-color: var(--status-bar-bg);
      color: white;
      font-size: 12px;
      line-height: 22px;
      padding: 0 10px;
      display: flex;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .popup {
      position: fixed;
      bottom: 70px;
      left: 5%;
      width: 90%;
      max-width: 500px;
      background-color: var(--tab-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      display: none;
      flex-direction: column;
      padding: 15px;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }

    .popup-header {
      font-weight: bold;
      margin-bottom: 10px;
      color: #cccccc;
    }

    .popup textarea {
      width: 100%;
      height: 120px;
      background-color: var(--editor-bg);
      color: white;
      border: 1px solid var(--border-color);
      resize: vertical;
      padding: 10px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      border-radius: 4px;
      outline: none;
      line-height: 1.5;
      min-height: 80px;
      max-height: 300px;
    }

    .popup textarea:focus {
      border-color: var(--accent-color);
    }

    .popup-buttons {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .popup-buttons button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .submit-btn {
      background-color: var(--accent-color);
      color: white;
    }

    .submit-btn:hover {
      background-color: #005a9e;
    }

    .clear-btn {
      background-color: #444;
      color: white;
    }

    .clear-btn:hover {
      background-color: #555;
    }

    .cancel-btn {
      background-color: #666;
      color: white;
    }

    .cancel-btn:hover {
      background-color: #777;
    }

    .bot-trigger {
      position: fixed;
      bottom: 15px;
      right: 15px;
      width: 55px;
      height: 55px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-color), #005a9e);
      color: white;
      font-size: 24px;
      border: none;
      box-shadow: 0 4px 15px rgba(0,122,204,0.4);
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .bot-trigger:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(0,122,204,0.6);
    }

    .export-btn {
      position: fixed;
      bottom: 15px;
      right: 85px;
      width: 55px;
      height: 55px;
      border-radius: 50%;
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: white;
      font-size: 24px;
      border: none;
      box-shadow: 0 4px 15px rgba(76,175,80,0.4);
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .export-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(76,175,80,0.6);
    }

    .export-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 400px;
      background-color: var(--tab-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      display: none;
      flex-direction: column;
      padding: 15px;
      z-index: 1001;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }

    .export-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 10px 0;
    }

    .export-option {
      padding: 10px;
      background-color: var(--editor-bg);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .export-option:hover {
      background-color: #37373d;
    }

    .export-filename {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      background-color: var(--editor-bg);
      color: white;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
    }

    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-thumb {
      background: #555;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #666;
    }

    ::-webkit-scrollbar-track {
      background: var(--tab-bg);
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }

    .cursor {
      display: inline-block;
      width: 8px;
      height: 16px;
      background-color: #fff;
      vertical-align: middle;
      margin-left: 2px;
      animation: blink 1s infinite;
    }

    @media (max-width: 768px) {
      .menu-bar {
        padding-left: 2px;
      }
      
      .menu-item {
        padding: 5px 6px;
        font-size: 12px;
      }
      
      .tab {
        min-width: 100px;
        padding: 8px 8px;
        font-size: 12px;
      }
      
      .line-numbers {
        min-width: 30px;
        padding: 10px 4px;
      }
      
      .editor-container {
        padding: 10px 8px;
      }
      
      .bot-trigger, .export-btn {
        width: 50px;
        height: 50px;
        font-size: 20px;
      }
      
      .export-btn {
        right: 75px;
      }
    }
  </style>
</head>
<body>
  <!-- Top Bar -->
  <div class="top-bar">
    <div class="menu-bar">
      <div class="menu-item">File</div>
      <div class="menu-item">Edit</div>
      <div class="menu-item">Selection</div>
      <div class="menu-item">View</div>
      <div class="menu-item">Go</div>
      <div class="menu-item">Run</div>
      <div class="menu-item">Terminal</div>
      <div class="menu-item">Help</div>
    </div>
    <div class="file-tabs-container">
      <div class="file-tabs" id="fileTabs">
        <div class="tab active" data-file="main.js">
          <span>üìÑ</span>
          <span class="tab-name">main.js</span>
          <span class="close-btn" onclick="closeTab(event, 'main.js')">√ó</span>
        </div>
      </div>
      <button class="new-tab-btn" onclick="createNewTab()" title="New File">+</button>
    </div>
  </div>

  <!-- Main Container -->
  <div class="main-container">
    <!-- Sidebar -->
    <div class="side-bar">
      <div class="icon" title="Explorer" onclick="showFileExplorer()">üìÅ</div>
      <div class="icon" title="Search">üîç</div>
      <div class="icon" title="Source Control">üåø</div>
      <div class="icon" title="Extensions">üß©</div>
      <div class="icon" title="Settings">‚öôÔ∏è</div>
    </div>

    <!-- Editor Wrapper -->
    <div class="editor-wrapper">
      <div class="line-numbers" id="lineNumbers">1</div>
      <pre class="editor-container language-javascript"><code id="editor" class="language-javascript">// Welcome to VSCode Mobile!
// Click the chat button to add your code</code></pre>
    </div>
  </div>

  <!-- Status Bar -->
  <div class="status-bar">
    <span>JavaScript</span>
    <span>Lines: <span id="lineCount">2</span> | Ready</span>
  </div>

  <!-- Code Input Popup -->
  <div class="popup" id="popup">
    <div class="popup-header">üíª Code Editor</div>
    <input type="text" id="fileNameInput" placeholder="Enter filename (e.g., app.js, index.html, style.css)" 
           class="export-filename">
    <textarea id="codeInput" placeholder="Enter your code here...
Example:
function hello() {
  console.log('Hello World!');
}"></textarea>
    <div class="popup-buttons">
      <button class="submit-btn" onclick="submitCode()">Add Code</button>
      <button class="clear-btn" onclick="clearEditor()">Clear All</button>
      <button class="cancel-btn" onclick="togglePopup()">Cancel</button>
    </div>
  </div>

  <!-- Export Popup -->
  <div class="export-popup" id="exportPopup">
    <div class="popup-header">üì§ Export File</div>
    <input type="text" id="exportFilename" class="export-filename" placeholder="exported-file.js">
    <div class="export-options">
      <div class="export-option" onclick="exportFile('download')">üíæ Download File</div>
      <div class="export-option" onclick="exportFile('copy')">üìã Copy to Clipboard</div>
    </div>
    <div class="popup-buttons">
      <button class="cancel-btn" onclick="toggleExportPopup()">Cancel</button>
    </div>
  </div>

  <!-- Action Buttons -->
  <button class="bot-trigger" onclick="togglePopup()" title="Open Code Editor">üí¨</button>
  <button class="export-btn" onclick="toggleExportPopup()" title="Export File">üì§</button>

  <!-- Prism JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-html.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-jsx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>

  <script>
    let currentCode = "// Welcome to VSCode Mobile!\n// Click the chat button to add your code";
    let currentFile = "main.js";
    let files = {
      "main.js": "// Welcome to VSCode Mobile!\n// Click the chat button to add your code"
    };
    let isTypingEffectRunning = false;
    let typingTimeout = null;

    function getFileIcon(filename) {
      const ext = filename.split('.').pop().toLowerCase();
      const icons = {
        'js': 'üìÑ',
        'html': 'üåê',
        'css': 'üé®',
        'json': 'üìã',
        'md': 'üìù',
        'py': 'üêç',
        'java': '‚òï',
        'cpp': '‚ö°',
        'c': '‚ö°',
        'php': 'üêò',
        'rb': 'üíé',
        'go': 'üî∑',
        'rs': 'ü¶Ä',
        'ts': 'üìò',
        'jsx': '‚öõÔ∏è',
        'tsx': '‚öõÔ∏è',
        'vue': 'üíö',
        'xml': 'üìÑ',
        'yml': 'üìÑ',
        'yaml': 'üìÑ'
      };
      return icons[ext] || 'üìÑ';
    }

    function getLanguageFromExtension(filename) {
      const ext = filename.split('.').pop().toLowerCase();
      const languages = {
        'js': 'javascript',
        'jsx': 'jsx',
        'ts': 'typescript',
        'tsx': 'tsx',
        'html': 'html',
        'css': 'css',
        'json': 'json',
        'md': 'markdown',
        'py': 'python',
        'java': 'java',
        'cpp': 'cpp',
        'c': 'c',
        'php': 'php',
        'rb': 'ruby',
        'go': 'go',
        'rs': 'rust',
        'xml': 'xml',
        'yml': 'yaml',
        'yaml': 'yaml'
      };
      return languages[ext] || 'javascript';
    }

    function switchTab(filename) {
      if (isTypingEffectRunning) {
        clearTimeout(typingTimeout);
        isTypingEffectRunning = false;
        return;
      }
      
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      const targetTab = document.querySelector(`[data-file="${filename}"]`);
      if (targetTab) {
        targetTab.classList.add('active');
        currentFile = filename;
        
        const editor = document.getElementById("editor");
        const lineNumbers = document.getElementById("lineNumbers");
        const content = files[filename] || '';
        currentCode = content;
        editor.textContent = content;
        
        const language = getLanguageFromExtension(filename);
        editor.className = `language-${language}`;
        editor.parentElement.className = `editor-container language-${language}`;
        
        const lines = content.split('\n');
        updateLineNumbers(lines.length);
        Prism.highlightElement(editor);
        
        const editorWrapper = document.querySelector(".editor-wrapper");
        editorWrapper.scrollTop = 0;
        lineNumbers.style.transform = 'translateY(0px)';
        
        document.getElementById("lineCount").textContent = lines.length;
        updateStatusBarLanguage(filename);
      }
    }

    function updateStatusBarLanguage(filename) {
      const ext = filename.split('.').pop().toLowerCase();
      const languageMap = {
        'js': 'JavaScript',
        'jsx': 'JavaScript (JSX)',
        'ts': 'TypeScript',
        'tsx': 'TypeScript (TSX)',
        'html': 'HTML',
        'css': 'CSS',
        'json': 'JSON',
        'md': 'Markdown',
        'py': 'Python',
        'java': 'Java',
        'cpp': 'C++',
        'c': 'C',
        'php': 'PHP',
        'rb': 'Ruby',
        'go': 'Go',
        'rs': 'Rust'
      };
      
      document.querySelector('.status-bar span:first-child').textContent = languageMap[ext] || ext.toUpperCase();
    }

    function closeTab(event, filename) {
      event.stopPropagation();
      
      if (Object.keys(files).length === 1) {
        alert("Cannot close the last tab!");
        return;
      }
      
      delete files[filename];
      
      const tab = document.querySelector(`[data-file="${filename}"]`);
      if (tab) {
        tab.remove();
      }
      
      if (currentFile === filename) {
        const remainingFiles = Object.keys(files);
        if (remainingFiles.length > 0) {
          switchTab(remainingFiles[0]);
        }
      }
    }

    function createNewTab() {
      const filename = prompt("Enter filename:", "untitled.js");
      if (filename) {
        if (!filename.match(/^[\w,\s-]+\.[A-Za-z]{2,}$/)) {
          alert("Please enter a valid filename with extension (e.g., script.js, index.html)");
          return;
        }
        
        if (files[filename]) {
          switchTab(filename);
          return;
        }
        
        files[filename] = `// New file: ${filename}\n`;
        
        const tabsContainer = document.getElementById("fileTabs");
        const newTab = document.createElement("div");
        newTab.className = "tab";
        newTab.setAttribute("data-file", filename);
        newTab.onclick = () => switchTab(filename);
        
        newTab.innerHTML = `
          <span>${getFileIcon(filename)}</span>
          <span class="tab-name">${filename}</span>
          <span class="close-btn" onclick="closeTab(event, '${filename}')">√ó</span>
        `;
        
        tabsContainer.appendChild(newTab);
        switchTab(filename);
        newTab.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
      }
    }

    function togglePopup() {
      const popup = document.getElementById("popup");
      const isVisible = popup.style.display === "flex";
      popup.style.display = isVisible ? "none" : "flex";
      
      if (!isVisible) {
        document.getElementById("fileNameInput").focus();
      }
    }

    function toggleExportPopup() {
      const exportPopup = document.getElementById("exportPopup");
      const isVisible = exportPopup.style.display === "flex";
      exportPopup.style.display = isVisible ? "none" : "flex";
      
      if (!isVisible) {
        const exportFilename = document.getElementById("exportFilename");
        exportFilename.value = currentFile;
        exportFilename.focus();
      }
    }

    function updateLineNumbers(lineCount) {
      const lineNumbers = document.getElementById("lineNumbers");
      let numbers = "";
      for (let i = 1; i <= lineCount; i++) {
        numbers += i + (i < lineCount ? "\n" : "");
      }
      lineNumbers.textContent = numbers;
      document.getElementById("lineCount").textContent = lineCount;
    }

    function submitCode() {
      const input = document.getElementById("codeInput").value.trim();
      let filename = document.getElementById("fileNameInput").value.trim();
      
      if (!input) {
        alert("Please enter some code first!");
        return;
      }

      if (!filename) {
        filename = currentFile;
      }
      
      if (!filename.match(/^[\w,\s-]+\.[A-Za-z]{2,}$/)) {
        alert("Please enter a valid filename with extension (e.g., script.js, index.html)");
        return;
      }

      files[filename] = input;
      
      if (!document.querySelector(`[data-file="${filename}"]`)) {
        const tabsContainer = document.getElementById("fileTabs");
        const newTab = document.createElement("div");
        newTab.className = "tab";
        newTab.setAttribute("data-file", filename);
        newTab.onclick = () => switchTab(filename);
        
        newTab.innerHTML = `
          <span>${getFileIcon(filename)}</span>
          <span class="tab-name">${filename}</span>
          <span class="close-btn" onclick="closeTab(event, '${filename}')">√ó</span>
        `;
        
        tabsContainer.appendChild(newTab);
      }
      
      switchTab(filename);
      
      const editor = document.getElementById("editor");
      document.getElementById("popup").style.display = "none";
      document.getElementById("codeInput").value = "";
      document.getElementById("fileNameInput").value = "";
      
      editor.textContent = "";
      
      const lines = input.split('\n');
      updateLineNumbers(lines.length);
      
      typeAndHighlight(input, editor);
    }

    function clearEditor() {
      if (confirm("Are you sure you want to clear the current file?")) {
        const editor = document.getElementById("editor");
        const defaultContent = `// Empty file: ${currentFile}\n`;
        files[currentFile] = defaultContent;
        currentCode = defaultContent;
        editor.textContent = defaultContent;
        updateLineNumbers(2);
        Prism.highlightElement(editor);
        document.getElementById("popup").style.display = "none";
        document.getElementById("codeInput").value = "";
        document.getElementById("fileNameInput").value = "";
      }
    }

    function typeAndHighlight(code, container) {
      if (isTypingEffectRunning) {
        clearTimeout(typingTimeout);
        isTypingEffectRunning = false;
      }
      
      let i = 0;
      let buffer = "";
      const lines = code.split('\n');
      let currentLine = 1;
      const editorWrapper = container.parentElement.parentElement;
      const lineNumbers = document.getElementById("lineNumbers");
      isTypingEffectRunning = true;

      function typing() {
        if (i < code.length) {
          const char = code.charAt(i);
          buffer += char;
          
          if (char === '\n') {
            currentLine++;
          }
          
          container.textContent = buffer;
          updateLineNumbers(Math.max(currentLine, 1));
          Prism.highlightElement(container);
          
          const containerHeight = container.getBoundingClientRect().height;
          const wrapperHeight = editorWrapper.getBoundingClientRect().height;
          
          if (containerHeight > wrapperHeight) {
            const scrollTop = containerHeight - wrapperHeight + 50;
            editorWrapper.scrollTop = scrollTop;
            
            const lineHeight = 21;
            const visibleLines = Math.floor(wrapperHeight / lineHeight);
            const totalLines = Math.max(currentLine, 1);
            
            if (totalLines > visibleLines) {
              const lineNumberScrollTop = (totalLines - visibleLines) * lineHeight;
              lineNumbers.style.transform = `translateY(-${lineNumberScrollTop}px)`;
            }
          }
          
          i++;
          typingTimeout = setTimeout(typing, Math.random() * 10 + 10);
        } else {
          isTypingEffectRunning = false;
          updateLineNumbers(lines.length);
          files[currentFile] = code;
          currentCode = code;
          
          setTimeout(() => {
            editorWrapper.scrollTop = editorWrapper.scrollHeight;
            const lineHeight = 21;
            const wrapperHeight = editorWrapper.getBoundingClientRect().height;
            const visibleLines = Math.floor(wrapperHeight / lineHeight);
            const totalLines = lines.length;
            
            if (totalLines > visibleLines) {
              const lineNumberScrollTop = Math.max(0, (totalLines - visibleLines) * lineHeight);
              lineNumbers.style.transform = `translateY(-${lineNumberScrollTop}px)`;
            } else {
              lineNumbers.style.transform = 'translateY(0px)';
            }
          }, 100);
        }
      }

      typing();
    }

    function exportFile(method) {
      const filenameInput = document.getElementById("exportFilename");
      let filename = filenameInput.value.trim();
      
      if (!filename) {
        alert("Please enter a filename!");
        return;
      }
      
      if (!filename.includes('.')) {
        const ext = currentFile.split('.').pop();
        filename += `.${ext}`;
        filenameInput.value = filename;
      }
      
      const content = files[currentFile] || currentCode;
      
      if (method === 'download') {
        downloadFile(filename, content);
      } else if (method === 'copy') {
        copyToClipboard(content);
      }
      
      toggleExportPopup();
    }

    function downloadFile(filename, content) {
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function copyToClipboard(content) {
      navigator.clipboard.writeText(content)
        .then(() => {
          alert("Code copied to clipboard!");
        })
        .catch(err => {
          console.error('Failed to copy: ', err);
          alert("Failed to copy to clipboard. Please try again.");
        });
    }

    function showFileExplorer() {
      let fileList = "Files:\n\n";
      for (const file in files) {
        fileList += `üìÑ ${file}\n`;
      }
      
      const newFile = prompt(`${fileList}\nEnter filename to open or create:`);
      if (newFile) {
        if (files[newFile]) {
          switchTab(newFile);
        } else {
          files[newFile] = `// New file: ${newFile}\n`;
          createNewTabUI(newFile);
          switchTab(newFile);
        }
      }
    }
    
    function createNewTabUI(filename) {
      const tabsContainer = document.getElementById("fileTabs");
      const newTab = document.createElement("div");
      newTab.className = "tab";
      newTab.setAttribute("data-file", filename);
      newTab.onclick = () => switchTab(filename);
      
      newTab.innerHTML = `
        <span>${getFileIcon(filename)}</span>
        <span class="tab-name">${filename}</span>
        <span class="close-btn" onclick="closeTab(event, '${filename}')">√ó</span>
      `;
      
      tabsContainer.appendChild(newTab);
    }

    // Initialize
    window.addEventListener('load', function() {
      const editor = document.getElementById("editor");
      const editorWrapper = document.querySelector(".editor-wrapper");
      const lineNumbers = document.getElementById("lineNumbers");
      
      updateLineNumbers(2);
      Prism.highlightElement(editor);
      
      editorWrapper.addEventListener('scroll', function() {
        const scrollTop = this.scrollTop;
        lineNumbers.style.transform = `translateY(-${scrollTop}px)`;
      });
      
      updateStatusBarLanguage(currentFile);
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        togglePopup();
      }
      
      if (e.key === 'Escape') {
        document.getElementById("popup").style.display = "none";
        document.getElementById("exportPopup").style.display = "none";
      }
      
      if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
        e.preventDefault();
        createNewTab();
      }
      
      if ((e.ctrlKey || e.metaKey) && e.key === 'o') {
        e.preventDefault();
        showFileExplorer();
      }
      
      if ((e.ctrlKey || e.metaKey) && e.key === 's') {
        e.preventDefault();
        toggleExportPopup();
      }
    });

    // Auto-resize textarea
    document.getElementById('codeInput').addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 300) + 'px';
    });

    // Auto-suggest filename
    document.getElementById('codeInput').addEventListener('input', function() {
      const code = this.value.toLowerCase();
      const filenameInput = document.getElementById('fileNameInput');
      
      if (!filenameInput.value) {
        if (code.includes('<!doctype html') || code.includes('<html')) {
          filenameInput.placeholder = 'index.html';
        } else if (code.includes('function') || code.includes('const') || code.includes('let')) {
          filenameInput.placeholder = 'script.js';
        } else if (code.includes('body {') || code.includes('color:') || code.includes('margin:')) {
          filenameInput.placeholder = 'style.css';
        } else if (code.includes('def ') || code.includes('import ')) {
          filenameInput.placeholder = 'main.py';
        }
      }
    });
  </script>
</body>
</html> 
